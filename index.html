<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>LinkedIn InMail Assistant â€“ Confluent</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', sans-serif; min-height: 100vh; background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #1e1b4b 100%); color: white; }
  .wrap { max-width: 860px; margin: 0 auto; padding: 2.5rem 1.25rem 4rem; }
  .card { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.12); border-radius: 1rem; margin-bottom: 1.25rem; padding: 1.5rem 2rem; }
  .card-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.25rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.08); }
  .step-num { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.875rem; color: white; flex-shrink: 0; }
  .input-field { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.18); border-radius: 0.75rem; color: white; padding: 0.85rem 1rem; width: 100%; font-size: 0.875rem; outline: none; transition: border-color 0.2s; font-family: 'Segoe UI', sans-serif; resize: vertical; }
  .input-field::placeholder { color: rgba(255,255,255,0.3); }
  .input-field:focus { border-color: #60a5fa; }
  label { color: #93c5fd; font-size: 0.8rem; font-weight: 500; display: block; margin-bottom: 0.5rem; }
  .field-wrap { margin-bottom: 1.1rem; }
  .btn-primary { background: linear-gradient(135deg, #3b82f6, #6366f1); color: white; border: none; border-radius: 0.75rem; padding: 1rem 2rem; font-size: 1rem; font-weight: 600; cursor: pointer; width: 100%; transition: opacity 0.2s, transform 0.15s; }
  .btn-primary:hover:not(:disabled) { opacity: 0.9; transform: scale(1.01); }
  .btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }
  .cta-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
  .cta-btn { border: 2px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); border-radius: 0.75rem; padding: 1rem; cursor: pointer; text-align: left; transition: all 0.2s; width: 100%; color: white; }
  .cta-btn.active-cv { border-color: #60a5fa; background: rgba(96,165,250,0.15); }
  .cta-btn.active-call { border-color: #a78bfa; background: rgba(167,139,250,0.15); }
  .fu-box { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.1); border-radius: 0.75rem; padding: 1rem 1.25rem; }
  .fu-btns { display: flex; gap: 0.75rem; margin: 0.85rem 0 0.6rem; }
  .count-btn { border: 2px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: rgba(255,255,255,0.5); border-radius: 0.75rem; padding: 0.65rem; font-size: 1.25rem; font-weight: 700; cursor: pointer; transition: all 0.2s; flex: 1; }
  .count-btn.active { border-color: #60a5fa; background: rgba(96,165,250,0.15); color: #93c5fd; }
  .spinner { border: 3px solid rgba(255,255,255,0.2); border-top-color: #60a5fa; border-radius: 50%; width: 20px; height: 20px; animation: spin 0.8s linear infinite; display: inline-block; vertical-align: middle; margin-right: 8px; }
  @keyframes spin { to { transform: rotate(360deg); } }
  .error-box { background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.3); border-radius: 0.75rem; padding: 1rem 1.25rem; margin-top: 1rem; color: #fca5a5; font-size: 0.85rem; display: none; line-height: 1.5; }
  .subj-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 0.75rem; padding: 0.75rem 1rem; display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem; gap: 1rem; }
  .copy-btn { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); color: rgba(255,255,255,0.6); border-radius: 0.5rem; padding: 0.3rem 0.7rem; font-size: 0.75rem; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
  .copy-btn:hover { background: rgba(255,255,255,0.15); color: white; }
  .msg-card { background: rgba(255,255,255,0.07); border: 1px solid rgba(255,255,255,0.1); border-radius: 1rem; overflow: hidden; margin-bottom: 1rem; }
  .msg-header { padding: 1.1rem 1.5rem; display: flex; align-items: center; gap: 0.75rem; cursor: pointer; transition: background 0.2s; }
  .msg-header:hover { background: rgba(255,255,255,0.05); }
  .msg-body { padding: 0 1.5rem 1.5rem; display: none; }
  .msg-body.open { display: block; }
  .inner-box { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); border-radius: 0.75rem; padding: 1rem; margin-bottom: 0.75rem; }
  .badge { font-size: 0.7rem; font-weight: 600; padding: 0.2rem 0.6rem; border-radius: 9999px; border: 1px solid; white-space: nowrap; }
  .badge-blue   { background: rgba(96,165,250,0.15); color: #93c5fd; border-color: rgba(96,165,250,0.3); }
  .badge-indigo { background: rgba(129,140,248,0.15); color: #a5b4fc; border-color: rgba(129,140,248,0.3); }
  .badge-purple { background: rgba(168,85,247,0.15); color: #d8b4fe; border-color: rgba(168,85,247,0.3); }
  .badge-pink   { background: rgba(236,72,153,0.15); color: #f9a8d4; border-color: rgba(236,72,153,0.3); }
  .micro-label { color: rgba(255,255,255,0.35); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem; }
  pre { white-space: pre-wrap; font-family: 'Segoe UI', sans-serif; color: rgba(255,255,255,0.82); font-size: 0.875rem; line-height: 1.8; }
  .reset-btn { width: 100%; padding: 0.85rem; border: 1px solid rgba(255,255,255,0.2); background: transparent; color: rgba(255,255,255,0.5); border-radius: 0.75rem; cursor: pointer; font-size: 0.875rem; margin-top: 0.5rem; transition: all 0.2s; }
  .reset-btn:hover { color: white; border-color: rgba(255,255,255,0.4); }
  .state-indicator { font-size: 0.7rem; padding: 0.15rem 0.5rem; border-radius: 9999px; margin-left: 0.5rem; }
  .state-cv { background: rgba(96,165,250,0.2); color: #93c5fd; }
  .state-call { background: rgba(167,139,250,0.2); color: #c4b5fd; }
</style>
</head>
<body>
<div class="wrap">

  <!-- Header -->
  <div style="text-align:center; margin-bottom:2rem;">
    <div style="display:inline-flex; align-items:center; justify-content:center; width:64px; height:64px; background:linear-gradient(135deg,#3b82f6,#6366f1); border-radius:1rem; margin-bottom:1.25rem; box-shadow:0 4px 20px rgba(99,102,241,0.4);">
      <svg width="30" height="30" fill="white" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
    </div>
    <h1 style="font-size:2rem; font-weight:700; margin-bottom:0.5rem;">LinkedIn InMail Assistant</h1>
    <p style="color:#93c5fd;">Craft targeted, high-converting InMails for candidate outreach â€” in seconds.</p>
  </div>

  <!-- Step 1 -->
  <div class="card">
    <div class="card-header">
      <div class="step-num" style="background:#3b82f6;">1</div>
      <h2 style="font-size:1.15rem; font-weight:600;">Role Details</h2>
    </div>

    <div class="field-wrap">
      <label>ğŸ“„ Job Description <span style="color:#f87171;">*</span></label>
      <textarea id="jd" class="input-field" rows="7" placeholder="Paste the full job description here..."></textarea>
    </div>

    <div class="field-wrap">
      <label>ğŸ”— Job URL <span style="color:#f87171;">*</span></label>
      <input id="jobUrl" type="url" class="input-field" placeholder="https://careers.confluent.io/jobs/..." />
    </div>

    <div class="field-wrap">
      <label>ğŸ‘¥ Call-to-Action Style <span style="color:#f87171;">*</span>
        <span id="ctaIndicator" class="state-indicator state-cv">CV Ask selected</span>
      </label>
      <div class="cta-grid">
        <button id="btnCV" class="cta-btn active-cv" onclick="setCTA('cv')">
          <div style="font-weight:600;font-size:0.875rem;margin-bottom:0.25rem;">ğŸ“„ Direct CV Ask</div>
          <div style="color:rgba(255,255,255,0.5);font-size:0.75rem;">End message by asking candidate to share their updated CV.</div>
        </button>
        <button id="btnCall" class="cta-btn" onclick="setCTA('call')">
          <div style="font-weight:600;font-size:0.875rem;margin-bottom:0.25rem;">ğŸ“ Interest + Call</div>
          <div style="color:rgba(255,255,255,0.5);font-size:0.75rem;">End message by gauging interest and proposing a quick call.</div>
        </button>
      </div>
    </div>

    <div class="fu-box">
      <p style="font-weight:500;font-size:0.875rem;">How many follow-up emails do you need?
        <span id="fuIndicator" style="font-size:0.7rem; color:#93c5fd; margin-left:0.5rem;">1 selected</span>
      </p>
      <p style="color:rgba(255,255,255,0.35);font-size:0.75rem;margin-top:0.2rem;">Each follow-up escalates gradually in directness</p>
      <div class="fu-btns">
        <button id="fuBtn1" class="count-btn active" onclick="setFU(1)">1</button>
        <button id="fuBtn2" class="count-btn" onclick="setFU(2)">2</button>
        <button id="fuBtn3" class="count-btn" onclick="setFU(3)">3</button>
      </div>
      <p id="fuDesc" style="color:rgba(255,255,255,0.25);font-size:0.75rem;text-align:center;">1 gentle follow-up</p>
    </div>
  </div>

  <!-- Step 2 -->
  <div class="card">
    <div class="card-header">
      <div class="step-num" style="background:#6366f1;">2</div>
      <div>
        <h2 style="font-size:1.15rem;font-weight:600;">Your Sample InMails <span style="color:rgba(255,255,255,0.35);font-weight:400;font-size:0.875rem;">(Optional)</span></h2>
        <p style="color:rgba(255,255,255,0.35);font-size:0.78rem;margin-top:0.2rem;">3 of your InMails are pre-loaded as style reference â€” add more to refine further</p>
      </div>
    </div>
    <textarea id="sampleInMail" class="input-field" rows="5" placeholder="Your 3 sample InMails are pre-loaded as reference. Paste additional examples here to supplement them..."></textarea>
  </div>

  <!-- Debug indicator -->
  <div id="debugBar" style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:0.75rem;padding:0.6rem 1rem;margin-bottom:1rem;font-size:0.75rem;color:rgba(255,255,255,0.4);display:flex;gap:1.5rem;">
    <span>CTA: <strong id="dbCTA" style="color:#93c5fd;">CV Ask</strong></span>
    <span>Follow-ups: <strong id="dbFU" style="color:#93c5fd;">1</strong></span>
  </div>

  <button class="btn-primary" id="generateBtn" onclick="generate()">âœ¨ Generate InMail Messages</button>
  <div class="error-box" id="errorBox"></div>

  <!-- Results -->
  <div id="results" style="display:none;margin-top:1.5rem;">
    <div class="card">
      <div style="display:flex;align-items:center;gap:0.75rem;margin-bottom:1rem;padding-bottom:0.75rem;border-bottom:1px solid rgba(255,255,255,0.08);">
        <span style="font-size:1.1rem;">âœ¨</span>
        <h3 style="font-size:1rem;font-weight:600;flex:1;">Creative Subject Line Options</h3>
        <span style="color:rgba(255,255,255,0.3);font-size:0.72rem;background:rgba(255,255,255,0.07);padding:0.2rem 0.6rem;border-radius:9999px;">Pick your favourite</span>
      </div>
      <div id="subjLines"></div>
    </div>
    <div id="msgCards"></div>
    <button class="reset-btn" onclick="resetAll()">ğŸ”„ Start Over</button>
  </div>
</div>

<script>
// â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const GROQ_KEY = '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';
const GROQ_URL = 'https://api.groq.com/openai/v1/chat/completions';
const MODEL    = 'llama-3.3-70b-versatile';

// â”€â”€ App State (single source of truth) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const state = { cta: 'cv', fuCount: 1, openSection: null };

// â”€â”€ CTA Toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setCTA(val) {
  state.cta = val;
  document.getElementById('btnCV').className   = 'cta-btn' + (val === 'cv'   ? ' active-cv'   : '');
  document.getElementById('btnCall').className = 'cta-btn' + (val === 'call' ? ' active-call' : '');
  document.getElementById('ctaIndicator').textContent = val === 'cv' ? 'CV Ask selected' : 'Interest + Call selected';
  document.getElementById('ctaIndicator').className = 'state-indicator ' + (val === 'cv' ? 'state-cv' : 'state-call');
  document.getElementById('dbCTA').textContent = val === 'cv' ? 'CV Ask' : 'Interest + Call';
  console.log('CTA set to:', state.cta);
}

// â”€â”€ Follow-Up Count â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setFU(n) {
  state.fuCount = n;
  [1,2,3].forEach(i => {
    document.getElementById('fuBtn'+i).className = 'count-btn' + (i === n ? ' active' : '');
  });
  const descs = { 1:'1 gentle follow-up', 2:'1 gentle + 1 more direct follow-up', 3:'1 gentle + 1 direct + 1 final nudge' };
  document.getElementById('fuDesc').textContent = descs[n];
  document.getElementById('fuIndicator').textContent = n + ' selected';
  document.getElementById('dbFU').textContent = n;
  console.log('FU count set to:', state.fuCount);
}

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function esc(s)  { return (s||'').replace(/\\/g,'\\\\').replace(/`/g,'\\`').replace(/\$/g,'\\$'); }
function escH(s) { return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function copyText(text, id) {
  navigator.clipboard.writeText(text).then(() => {
    const b = document.getElementById(id), o = b.textContent;
    b.textContent = 'âœ“ Copied!'; b.style.color = '#4ade80';
    setTimeout(() => { b.textContent = o; b.style.color = ''; }, 2000);
  }).catch(() => {
    const t = document.createElement('textarea');
    t.value = text; document.body.appendChild(t); t.select();
    document.execCommand('copy'); document.body.removeChild(t);
  });
}

function toggleSection(id) {
  const was = state.openSection === id;
  document.querySelectorAll('.msg-body').forEach(e => e.classList.remove('open'));
  document.querySelectorAll('.chevron').forEach(e => e.textContent = 'â–¼');
  state.openSection = was ? null : id;
  if (state.openSection) {
    document.getElementById('body-' + state.openSection)?.classList.add('open');
    const c = document.getElementById('chev-' + state.openSection);
    if (c) c.textContent = 'â–²';
  }
}

function msgCard(id, icon, badge, bCls, title, subj, body) {
  const bodyFormatted = (body||'').replace(/\\n/g, '\n');
  return `<div class="msg-card">
    <div class="msg-header" onclick="toggleSection('${id}')">
      <span>${icon}</span>
      <span style="font-weight:600;font-size:0.95rem;flex:1;">${title}</span>
      <span class="badge ${bCls}">${badge}</span>
      <span class="chevron" id="chev-${id}" style="color:rgba(255,255,255,0.3);margin-left:0.5rem;font-size:0.75rem;">â–¼</span>
    </div>
    <div class="msg-body" id="body-${id}">
      <div class="inner-box" style="display:flex;align-items:flex-start;justify-content:space-between;gap:1rem;">
        <div style="flex:1;">
          <div class="micro-label">Suggested Subject</div>
          <div style="color:rgba(255,255,255,0.9);font-size:0.875rem;font-weight:500;">"${escH(subj)}"</div>
        </div>
        <button class="copy-btn" id="cp-${id}-s" onclick="copyText(\`${esc(subj)}\`,'cp-${id}-s')">ğŸ“‹ Copy</button>
      </div>
      <div class="inner-box">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:0.75rem;">
          <div class="micro-label">Message Body</div>
          <button class="copy-btn" id="cp-${id}-b" onclick="copyText(\`${esc(bodyFormatted)}\`,'cp-${id}-b')">ğŸ“‹ Copy</button>
        </div>
        <pre>${escH(bodyFormatted)}</pre>
      </div>
    </div>
  </div>`;
}

function showError(msg) {
  const b = document.getElementById('errorBox');
  b.innerHTML = 'âš ï¸ ' + msg; b.style.display = 'block';
}

// â”€â”€ Generate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function generate() {
  const jd     = document.getElementById('jd').value.trim();
  const jobUrl = document.getElementById('jobUrl').value.trim();
  const sample = document.getElementById('sampleInMail').value.trim();

  document.getElementById('errorBox').style.display = 'none';
  if (!jd)     { showError('Please paste the Job Description.'); return; }
  if (!jobUrl) { showError('Please enter the Job URL.'); return; }

  // Read state at time of click
  const currentCTA = state.cta;
  const currentFU  = state.fuCount;
  console.log('Generating with CTA:', currentCTA, 'FU count:', currentFU);

  const btn = document.getElementById('generateBtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Crafting your InMails...';
  document.getElementById('results').style.display = 'none';

  // Build CTA instruction
  const ctaInstruction = currentCTA === 'cv'
    ? 'The outreach message must end with asking the candidate to share their updated CV so you can discuss further details.'
    : 'The outreach message must end by asking if the candidate is open to this opportunity and suggesting a short 15-minute introductory call.';

  // Build follow-up schema and rules
  const fu2schema = currentFU >= 2 ? `,"followUp2":{"subject":"string","body":"string"}` : '';
  const fu3schema = currentFU >= 3 ? `,"followUp3":{"subject":"string","body":"string"}` : '';

  let fuInstruction = '';
  if (currentFU === 1) {
    fuInstruction = 'Generate exactly 1 follow-up message with the key "followUp". It should be 60-80 words, warm and polite, referencing the previous outreach, and must include the job URL.';
  } else if (currentFU === 2) {
    fuInstruction = 'Generate exactly 2 follow-up messages: "followUp" (60-80 words, warm, polite, includes job URL) and "followUp2" (50-70 words, slightly more direct, still polite, includes job URL).';
  } else {
    fuInstruction = 'Generate exactly 3 follow-up messages: "followUp" (60-80 words, warm, polite, includes job URL), "followUp2" (50-70 words, more direct, includes job URL), and "followUp3" (40-60 words, final polite nudge making clear this is the last message, includes job URL).';
  }

  const defaultSamples = `Sample 1:
Hi {firstName}, I'm Vikash from the Talent Sourcing team at Confluent, and I hope you're doing well.
I'm currently hiring for a Staff Security Engineer II role at Confluent (Remote - India), focused on shaping application security architecture across large-scale distributed systems and cloud platforms.
Job link: https://careers.confluent.io/jobs/...
If this aligns with your experience or interests, please feel free to share your CV, and we can discuss further.
Looking forward to hearing from you. Regards, Vikash

Sample 2:
Hi {firstName}, I'm the Lead Talent Sourcer for Technical Management positions across EMEA here at Confluent.
We're building the next-generation cloud network data plane to scale our Confluent Cloud platform. We're looking for a Staff Software Engineer with strong expertise in distributed systems, networking, and large-scale cloud systems.
Role details: [Job Link] â€” Full-time permanent role (no B2B).
Let me know if this sounds interesting â€” I'd be happy to connect and share more details. Best Regards, Vikash

Sample 3:
Hi {firstName}, I'm Vikash Chauhan from Confluent's Talent Sourcing team, and I'm reaching out with an exciting opportunity.
Our Stream Processing & Analytics team is building the next-generation Apache Flink-based stream processing engine to power Confluent Cloud â€” an elastic, reliable, and cost-efficient platform.
We are hiring a Staff Engineer to define the long-term vision for a truly cloud-native data stream processor. This role offers the chance to architect scalable distributed systems, lead open-source contributions, drive technical strategy, and mentor engineers across AWS, Azure, and GCP at massive scale.
[Job Link] â€” Germany
Would you be open to discussing this opportunity? Best Regards, Vikash`;

  const sampleBlock = sample
    ? `Here are sample InMails I have previously written. Match my tone, style, structure, and formatting exactly â€” but improve the content quality:\n"""\n${sample}\n"""\n`
    : `Here are sample InMails I have previously written. Match my tone, style, structure, and formatting exactly â€” but improve the content quality:\n"""\n${defaultSamples}\n"""\n`;

  const prompt = `You are an expert LinkedIn recruiter copywriter working for Confluent's Talent Sourcing team. Generate compelling, human, well-formatted InMail messages.

Job Description:
"""
${jd}
"""

Job URL: ${jobUrl}

CTA INSTRUCTION (MUST FOLLOW): ${ctaInstruction}

FOLLOW-UP INSTRUCTION (MUST FOLLOW): ${fuInstruction}

${sampleBlock}

OUTPUT FORMAT: Return ONLY a valid JSON object. No markdown. No backticks. No text before or after.
Use \\n for line breaks inside JSON strings. Never use raw line breaks inside JSON strings.

JSON structure:
{"subjectLines":["s1","s2","s3","s4"],"outreach":{"subject":"string","body":"string"},"followUp":{"subject":"string","body":"string"}${fu2schema}${fu3schema}}

SUBJECT LINE RULES:
- Must feel human, curiosity-driven â€” NOT a job title dump
- Must naturally include "Confluent" AND the job location in format "Location (Remote)" e.g. "India (Remote)" or "Germany (Remote)"
- Must reference the role title or a key skill from the JD in a creative, appealing way
- Good examples: "Join Confluent as a Staff Security Engineer â€“ India (Remote)", "Your next big move: Staff Security Engineer at Confluent | India (Remote)", "Confluent is looking for a Security Expert â€“ Could it be you? | India (Remote)"
- Bad examples (never do this): "Confluent India Staff Security Engineer", "Confluent Remote India Security Role"
- Max 14 words. No ALL CAPS.

OUTREACH BODY RULES:
- Length: 120-150 words maximum. Concise, warm, punchy â€” optimized for LinkedIn InMail where shorter messages get higher response rates
- Line 1: ALWAYS start with exactly "Hi {firstName}," on its own line
- Line 2: ALWAYS second line: make it warm and engaging, something like "I'm Vikash from the Talent Sourcing team at Confluent â€” I hope you're having a great week!" or "I'm Vikash, part of the Talent Sourcing team at Confluent, and I'm reaching out with something I think could genuinely excite you!" â€” vary it but always mention Vikash + Confluent Talent Sourcing team
- Paragraph 2: What the team is building â€” exciting, meaningful, include technical context from JD
- Paragraph 3: What makes this role special â€” impact, scale, tech stack, team mission. End this paragraph with a natural mention of the role like "...and we'd love to have someone like you join us as our next [Role Title] based [Location (Remote)]."
- Paragraph 4: Job URL line â€” e.g. "You can explore the full details here: [URL]"
- Paragraph 5: CTA line â€” MUST follow the CTA instruction above exactly
- Closing line: ALWAYS end with "Best regards," or "Warm regards," or "Looking forward to hearing from you," followed by a new line with just "Vikash"

FOLLOW-UP BODY RULES:
- Must follow the follow-up instruction above exactly
- Always start with "Hi {firstName},"
- Include a brief reference to the previous outreach (e.g. "I wanted to follow up on my previous message about the [Role Title] opportunity at Confluent")
- Add more context about the role or team â€” don't just say "just checking in", give them a reason to respond
- Include the job URL naturally
- End with "Best regards," or "Warm regards," followed by "Vikash"
- Use \\n\\n between paragraphs`;

  try {
    const res = await fetch(GROQ_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${GROQ_KEY}`
      },
      body: JSON.stringify({
        model: MODEL,
        messages: [{ role: 'user', content: prompt }],
        temperature: 0.75,
        max_tokens: 2500
      })
    });

    const data = await res.json();
    if (data.error) throw new Error(data.error.message);

    const raw = data.choices?.[0]?.message?.content || '';
    console.log('Raw response:', raw.substring(0, 200));

    // Clean and parse JSON
    let clean = raw.replace(/```json|```/gi, '').trim();
    // Extract JSON object if there's surrounding text
    const start = clean.indexOf('{');
    const end   = clean.lastIndexOf('}');
    if (start !== -1 && end !== -1) clean = clean.slice(start, end + 1);

    const r = JSON.parse(clean);
    console.log('Parsed result keys:', Object.keys(r));

    // Render subject lines
    document.getElementById('subjLines').innerHTML = (r.subjectLines || []).map((s, i) =>
      `<div class="subj-card">
        <span style="color:rgba(255,255,255,0.88);font-size:0.875rem;flex:1;">"${escH(s)}"</span>
        <button class="copy-btn" id="cs${i}" onclick="copyText(\`${esc(s)}\`,'cs${i}')">ğŸ“‹ Copy</button>
      </div>`
    ).join('');

    // Render message cards
    let cards = '';
    cards += msgCard('outreach', 'ğŸ“¤', 'Outreach',    'badge-blue',   'First Outreach InMail', r.outreach?.subject,  r.outreach?.body);
    cards += msgCard('followup', 'ğŸ’¬', 'Follow-Up 1', 'badge-indigo', '1st Follow-Up InMail',  r.followUp?.subject,  r.followUp?.body);
    if (r.followUp2) cards += msgCard('followup2', 'ğŸ’¬', 'Follow-Up 2', 'badge-purple', '2nd Follow-Up InMail', r.followUp2.subject, r.followUp2.body);
    if (r.followUp3) cards += msgCard('followup3', 'ğŸ’¬', 'Follow-Up 3', 'badge-pink',   '3rd Follow-Up InMail', r.followUp3.subject, r.followUp3.body);
    document.getElementById('msgCards').innerHTML = cards;

    document.getElementById('results').style.display = 'block';
    setTimeout(() => document.getElementById('results').scrollIntoView({ behavior: 'smooth' }), 100);
    toggleSection('outreach');

  } catch(err) {
    console.error('Error:', err);
    showError('Something went wrong: ' + err.message + '<br>Please try again.');
  } finally {
    btn.disabled = false;
    btn.innerHTML = 'âœ¨ Generate InMail Messages';
  }
}

function resetAll() {
  document.getElementById('jd').value = '';
  document.getElementById('jobUrl').value = '';
  document.getElementById('sampleInMail').value = '';
  setCTA('cv');
  setFU(1);
  document.getElementById('results').style.display = 'none';
  document.getElementById('errorBox').style.display = 'none';
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
</script>
</body>
</html>
