<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>LinkedIn InMail Assistant ‚Äì Confluent</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', sans-serif; min-height: 100vh; background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #1e1b4b 100%); color: white; }
  .wrap { max-width: 860px; margin: 0 auto; padding: 2.5rem 1.25rem 4rem; }
  .card { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.12); border-radius: 1rem; margin-bottom: 1.25rem; padding: 1.5rem 2rem; }
  .card-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.25rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.08); }
  .step-num { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.875rem; color: white; flex-shrink: 0; }
  .input-field { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.18); border-radius: 0.75rem; color: white; padding: 0.85rem 1rem; width: 100%; font-size: 0.875rem; outline: none; transition: border-color 0.2s; font-family: 'Segoe UI', sans-serif; resize: vertical; }
  .input-field::placeholder { color: rgba(255,255,255,0.3); }
  .input-field:focus { border-color: #60a5fa; }
  label { color: #93c5fd; font-size: 0.8rem; font-weight: 500; display: block; margin-bottom: 0.5rem; }
  .field-wrap { margin-bottom: 1.1rem; }
  .btn-primary { background: linear-gradient(135deg, #3b82f6, #6366f1); color: white; border: none; border-radius: 0.75rem; padding: 1rem 2rem; font-size: 1rem; font-weight: 600; cursor: pointer; width: 100%; transition: opacity 0.2s, transform 0.15s; }
  .btn-primary:hover:not(:disabled) { opacity: 0.9; transform: scale(1.01); }
  .btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }
  .cta-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
  .cta-btn { border: 2px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); border-radius: 0.75rem; padding: 1rem; cursor: pointer; text-align: left; transition: all 0.2s; width: 100%; color: white; }
  .cta-btn.active-cv { border-color: #60a5fa; background: rgba(96,165,250,0.12); }
  .cta-btn.active-call { border-color: #818cf8; background: rgba(129,140,248,0.12); }
  .fu-box { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.1); border-radius: 0.75rem; padding: 1rem 1.25rem; }
  .fu-btns { display: flex; gap: 0.75rem; margin: 0.85rem 0 0.6rem; }
  .count-btn { border: 2px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: rgba(255,255,255,0.5); border-radius: 0.75rem; padding: 0.65rem; font-size: 1.25rem; font-weight: 700; cursor: pointer; transition: all 0.2s; flex: 1; }
  .count-btn.active { border-color: #60a5fa; background: rgba(96,165,250,0.15); color: #93c5fd; }
  .spinner { border: 3px solid rgba(255,255,255,0.2); border-top-color: #60a5fa; border-radius: 50%; width: 20px; height: 20px; animation: spin 0.8s linear infinite; display: inline-block; vertical-align: middle; margin-right: 8px; }
  @keyframes spin { to { transform: rotate(360deg); } }
  .error-box { background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.3); border-radius: 0.75rem; padding: 1rem 1.25rem; margin-top: 1rem; color: #fca5a5; font-size: 0.85rem; display: none; }
  .subj-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 0.75rem; padding: 0.75rem 1rem; display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem; gap: 1rem; }
  .copy-btn { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); color: rgba(255,255,255,0.6); border-radius: 0.5rem; padding: 0.3rem 0.7rem; font-size: 0.75rem; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
  .copy-btn:hover { background: rgba(255,255,255,0.15); color: white; }
  .msg-card { background: rgba(255,255,255,0.07); border: 1px solid rgba(255,255,255,0.1); border-radius: 1rem; overflow: hidden; margin-bottom: 1rem; }
  .msg-header { padding: 1.1rem 1.5rem; display: flex; align-items: center; gap: 0.75rem; cursor: pointer; transition: background 0.2s; }
  .msg-header:hover { background: rgba(255,255,255,0.05); }
  .msg-body { padding: 0 1.5rem 1.5rem; display: none; }
  .msg-body.open { display: block; }
  .inner-box { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); border-radius: 0.75rem; padding: 1rem; margin-bottom: 0.75rem; }
  .badge { font-size: 0.7rem; font-weight: 600; padding: 0.2rem 0.6rem; border-radius: 9999px; border: 1px solid; white-space: nowrap; }
  .badge-blue   { background: rgba(96,165,250,0.15); color: #93c5fd; border-color: rgba(96,165,250,0.3); }
  .badge-indigo { background: rgba(129,140,248,0.15); color: #a5b4fc; border-color: rgba(129,140,248,0.3); }
  .badge-purple { background: rgba(168,85,247,0.15); color: #d8b4fe; border-color: rgba(168,85,247,0.3); }
  .badge-pink   { background: rgba(236,72,153,0.15); color: #f9a8d4; border-color: rgba(236,72,153,0.3); }
  .micro-label { color: rgba(255,255,255,0.35); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem; }
  pre { white-space: pre-wrap; font-family: 'Segoe UI', sans-serif; color: rgba(255,255,255,0.8); font-size: 0.85rem; line-height: 1.7; }
  .reset-btn { width: 100%; padding: 0.85rem; border: 1px solid rgba(255,255,255,0.2); background: transparent; color: rgba(255,255,255,0.5); border-radius: 0.75rem; cursor: pointer; font-size: 0.875rem; margin-top: 0.5rem; transition: all 0.2s; }
  .reset-btn:hover { color: white; border-color: rgba(255,255,255,0.4); }
  /* Lock Screen */
  #lockScreen { position: fixed; inset: 0; background: linear-gradient(135deg, #0f172a, #1e3a5f, #1e1b4b); display: flex; align-items: center; justify-content: center; z-index: 999; padding: 1rem; }
  .lock-card { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); border-radius: 1.25rem; padding: 2.5rem; width: 100%; max-width: 440px; }
  .lock-icon { width: 60px; height: 60px; background: linear-gradient(135deg,#3b82f6,#6366f1); border-radius: 1rem; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.25rem; }
  .lock-title { font-size: 1.4rem; font-weight: 700; text-align: center; margin-bottom: 0.3rem; }
  .lock-sub { color: #93c5fd; font-size: 0.875rem; text-align: center; margin-bottom: 1.75rem; }
  .lock-label { color: rgba(255,255,255,0.5); font-size: 0.78rem; font-weight: 500; margin-bottom: 0.4rem; display: block; }
  .lock-input-wrap { position: relative; margin-bottom: 1rem; }
  .lock-input { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.2); border-radius: 0.75rem; color: white; padding: 0.85rem 3rem 0.85rem 1rem; width: 100%; font-size: 0.9rem; outline: none; transition: border-color 0.2s; font-family: 'Segoe UI', sans-serif; }
  .lock-input::placeholder { color: rgba(255,255,255,0.25); }
  .lock-input:focus { border-color: #60a5fa; }
  .show-btn { position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: rgba(255,255,255,0.35); cursor: pointer; font-size: 0.7rem; font-weight: 600; letter-spacing: 0.05em; }
  .lock-btn { background: linear-gradient(135deg,#3b82f6,#6366f1); color: white; border: none; border-radius: 0.75rem; padding: 0.9rem; width: 100%; font-size: 1rem; font-weight: 600; cursor: pointer; transition: opacity 0.2s; margin-top: 0.5rem; }
  .lock-btn:hover { opacity: 0.9; }
  .lock-error { color: #fca5a5; font-size: 0.8rem; margin-top: 0.6rem; text-align: center; display: none; }
  .lock-hint { color: rgba(255,255,255,0.2); font-size: 0.72rem; text-align: center; margin-top: 1rem; }
  .divider { border: none; border-top: 1px solid rgba(255,255,255,0.08); margin: 1.25rem 0; }
  .key-info { background: rgba(96,165,250,0.08); border: 1px solid rgba(96,165,250,0.2); border-radius: 0.65rem; padding: 0.65rem 0.85rem; font-size: 0.75rem; color: rgba(255,255,255,0.45); margin-bottom: 1rem; line-height: 1.5; }
</style>
</head>
<body>

<!-- Lock Screen -->
<div id="lockScreen">
  <div class="lock-card">
    <div class="lock-icon">
      <svg width="28" height="28" fill="white" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
    </div>
    <div class="lock-title">InMail Assistant</div>
    <div class="lock-sub">Confluent Talent Sourcing Team</div>

    <!-- Password -->
    <span class="lock-label">üîí Access Password</span>
    <div class="lock-input-wrap">
      <input class="lock-input" id="lockPass" type="password" placeholder="Enter access password" onkeydown="if(event.key==='Enter')document.getElementById('lockApiKey').focus()" />
      <button class="show-btn" onclick="toggleVis('lockPass',this)">SHOW</button>
    </div>

    <hr class="divider" />

    <!-- API Key -->
    <span class="lock-label">üóùÔ∏è Your OpenRouter API Key</span>
    <div class="key-info">Your key is used only to call the AI API. It stays in your browser memory and is never saved or shared anywhere.</div>
    <div class="lock-input-wrap">
      <input class="lock-input" id="lockApiKey" type="password" placeholder="sk-or-v1-..." onkeydown="if(event.key==='Enter')unlock()" />
      <button class="show-btn" onclick="toggleVis('lockApiKey',this)">SHOW</button>
    </div>

    <button class="lock-btn" onclick="unlock()">üîì Enter Tool</button>
    <div class="lock-error" id="lockError"></div>
    <div class="lock-hint">Contact Vikash Chauhan for access ¬∑ <a href="https://openrouter.ai/keys" target="_blank" style="color:rgba(96,165,250,0.6);">Get free API key</a></div>
  </div>
</div>

<!-- Main App -->
<div class="wrap" id="mainApp" style="display:none;">
  <div style="text-align:center; margin-bottom:2rem;">
    <div style="display:inline-flex; align-items:center; justify-content:center; width:64px; height:64px; background:linear-gradient(135deg,#3b82f6,#6366f1); border-radius:1rem; margin-bottom:1.25rem; box-shadow:0 4px 20px rgba(99,102,241,0.4);">
      <svg width="30" height="30" fill="white" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
    </div>
    <h1 style="font-size:2rem; font-weight:700; margin-bottom:0.5rem;">LinkedIn InMail Assistant</h1>
    <p style="color:#93c5fd;">Craft targeted, high-converting InMails for candidate outreach ‚Äî in seconds.</p>
  </div>

  <!-- Step 1 -->
  <div class="card">
    <div class="card-header">
      <div class="step-num" style="background:#3b82f6;">1</div>
      <h2 style="font-size:1.15rem; font-weight:600;">Role Details</h2>
    </div>
    <div class="field-wrap">
      <label>üìÑ Job Description <span style="color:#f87171;">*</span></label>
      <textarea id="jd" class="input-field" rows="7" placeholder="Paste the full job description here..."></textarea>
    </div>
    <div class="field-wrap">
      <label>üîó Job URL <span style="color:#f87171;">*</span></label>
      <input id="jobUrl" type="url" class="input-field" placeholder="https://careers.confluent.io/jobs/..." />
    </div>
    <div class="field-wrap">
      <label>üë• Call-to-Action Style <span style="color:#f87171;">*</span></label>
      <div class="cta-grid">
        <button class="cta-btn active-cv" id="ctaCV" onclick="setCTA('cv')">
          <div style="font-weight:600;font-size:0.875rem;margin-bottom:0.25rem;">üìÑ Direct CV Ask</div>
          <div style="color:rgba(255,255,255,0.5);font-size:0.75rem;">Ask candidate to share their updated CV to discuss further.</div>
        </button>
        <button class="cta-btn" id="ctaCall" onclick="setCTA('call')">
          <div style="font-weight:600;font-size:0.875rem;margin-bottom:0.25rem;">üìû Interest + Call</div>
          <div style="color:rgba(255,255,255,0.5);font-size:0.75rem;">Gauge interest first and propose a quick introductory call.</div>
        </button>
      </div>
    </div>
    <div class="fu-box">
      <p style="font-weight:500;font-size:0.875rem;">How many follow-up emails do you need?</p>
      <p style="color:rgba(255,255,255,0.35);font-size:0.75rem;margin-top:0.2rem;">Each follow-up escalates gradually in directness</p>
      <div class="fu-btns">
        <button class="count-btn active" id="fu1" onclick="setFU(1)">1</button>
        <button class="count-btn" id="fu2" onclick="setFU(2)">2</button>
        <button class="count-btn" id="fu3" onclick="setFU(3)">3</button>
      </div>
      <p style="color:rgba(255,255,255,0.25);font-size:0.75rem;text-align:center;" id="fuDesc">1 gentle follow-up</p>
    </div>
  </div>

  <!-- Step 2 -->
  <div class="card">
    <div class="card-header">
      <div class="step-num" style="background:#6366f1;">2</div>
      <div>
        <h2 style="font-size:1.15rem;font-weight:600;">Your Sample InMails <span style="color:rgba(255,255,255,0.35);font-weight:400;font-size:0.875rem;">(Optional)</span></h2>
        <p style="color:rgba(255,255,255,0.35);font-size:0.78rem;margin-top:0.2rem;">3 of your InMails are pre-loaded as style reference ‚Äî add more to refine further</p>
      </div>
    </div>
    <textarea id="sampleInMail" class="input-field" rows="5" placeholder="Your 3 sample InMails are pre-loaded as reference. Paste additional examples here to override or supplement them..."></textarea>
  </div>

  <button class="btn-primary" id="generateBtn" onclick="generate()">‚ú® Generate InMail Messages</button>
  <div class="error-box" id="errorBox"></div>

  <!-- Results -->
  <div id="results" style="display:none;margin-top:1.5rem;">
    <div class="card">
      <div style="display:flex;align-items:center;gap:0.75rem;margin-bottom:1rem;padding-bottom:0.75rem;border-bottom:1px solid rgba(255,255,255,0.08);">
        <span style="font-size:1.1rem;">‚ú®</span>
        <h3 style="font-size:1rem;font-weight:600;flex:1;">Creative Subject Line Options</h3>
        <span style="color:rgba(255,255,255,0.3);font-size:0.72rem;background:rgba(255,255,255,0.07);padding:0.2rem 0.6rem;border-radius:9999px;">Pick your favourite</span>
      </div>
      <div id="subjLines"></div>
    </div>
    <div id="msgCards"></div>
    <button class="reset-btn" onclick="resetAll()">üîÑ Start Over</button>
  </div>
</div>

<script>
const ACCESS_PASSWORD = 'Confluent@2025';
const OR_URL = 'https://openrouter.ai/api/v1/chat/completions';
const MODEL  = 'meta-llama/llama-3.3-70b-instruct:free';
let OR_KEY = '';
let cta = 'cv', fuCount = 1, openSection = null;

function toggleVis(id, btn) {
  const el = document.getElementById(id);
  if (el.type === 'password') { el.type = 'text'; btn.textContent = 'HIDE'; }
  else { el.type = 'password'; btn.textContent = 'SHOW'; }
}

function unlock() {
  const pass = document.getElementById('lockPass').value.trim();
  const key  = document.getElementById('lockApiKey').value.trim();
  const err  = document.getElementById('lockError');
  if (pass !== ACCESS_PASSWORD) {
    err.textContent = '‚ùå Incorrect password. Please try again.';
    err.style.display = 'block';
    document.getElementById('lockPass').value = '';
    return;
  }
  if (!key || !key.startsWith('sk-or-')) {
    err.textContent = '‚ùå Please enter a valid OpenRouter API key (starts with sk-or-).';
    err.style.display = 'block';
    return;
  }
  OR_KEY = key;
  document.getElementById('lockScreen').style.display = 'none';
  document.getElementById('mainApp').style.display = 'block';
}

function setCTA(t) {
  cta = t;
  document.getElementById('ctaCV').className   = 'cta-btn'+(t==='cv'  ?' active-cv':'');
  document.getElementById('ctaCall').className = 'cta-btn'+(t==='call'?' active-call':'');
}

function setFU(n) {
  fuCount = n;
  [1,2,3].forEach(i => document.getElementById('fu'+i).className='count-btn'+(i===n?' active':''));
  document.getElementById('fuDesc').textContent = n===1?'1 gentle follow-up':n===2?'1 gentle + 1 more direct follow-up':'1 gentle + 1 direct + 1 final nudge';
}

function esc(s)  { return (s||'').replace(/\\/g,'\\\\').replace(/`/g,'\\`').replace(/\$/g,'\\$'); }
function escH(s) { return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function copyText(text, id) {
  navigator.clipboard.writeText(text).then(() => {
    const b = document.getElementById(id), o = b.textContent;
    b.textContent = '‚úì Copied!'; b.style.color = '#4ade80';
    setTimeout(() => { b.textContent = o; b.style.color = ''; }, 2000);
  }).catch(() => {
    const t = document.createElement('textarea');
    t.value = text; document.body.appendChild(t); t.select();
    document.execCommand('copy'); document.body.removeChild(t);
  });
}

function toggleSection(id) {
  const was = openSection === id;
  document.querySelectorAll('.msg-body').forEach(e => e.classList.remove('open'));
  document.querySelectorAll('.chevron').forEach(e => e.textContent = '‚ñº');
  openSection = was ? null : id;
  if (openSection) {
    document.getElementById('body-'+openSection)?.classList.add('open');
    const c = document.getElementById('chev-'+openSection);
    if (c) c.textContent = '‚ñ≤';
  }
}

function msgCard(id, icon, badge, bCls, title, subj, body) {
  return `<div class="msg-card">
    <div class="msg-header" onclick="toggleSection('${id}')">
      <span>${icon}</span>
      <span style="font-weight:600;font-size:0.95rem;flex:1;">${title}</span>
      <span class="badge ${bCls}">${badge}</span>
      <span class="chevron" id="chev-${id}" style="color:rgba(255,255,255,0.3);margin-left:0.5rem;font-size:0.75rem;">‚ñº</span>
    </div>
    <div class="msg-body" id="body-${id}">
      <div class="inner-box" style="display:flex;align-items:flex-start;justify-content:space-between;gap:1rem;">
        <div style="flex:1;"><div class="micro-label">Suggested Subject</div>
        <div style="color:rgba(255,255,255,0.9);font-size:0.875rem;font-weight:500;">"${escH(subj)}"</div></div>
        <button class="copy-btn" id="cp-${id}-s" onclick="copyText(\`${esc(subj)}\`,'cp-${id}-s')">üìã Copy</button>
      </div>
      <div class="inner-box">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:0.75rem;">
          <div class="micro-label">Message Body</div>
          <button class="copy-btn" id="cp-${id}-b" onclick="copyText(\`${esc(body)}\`,'cp-${id}-b')">üìã Copy</button>
        </div>
        <pre>${escH(body)}</pre>
      </div>
    </div>
  </div>`;
}

function showError(msg) {
  const b = document.getElementById('errorBox');
  b.textContent = '‚ö†Ô∏è ' + msg; b.style.display = 'block';
}

async function generate() {
  const jd     = document.getElementById('jd').value.trim();
  const jobUrl = document.getElementById('jobUrl').value.trim();
  const sample = document.getElementById('sampleInMail').value.trim();
  document.getElementById('errorBox').style.display = 'none';
  if (!jd)     { showError('Please paste the Job Description.'); return; }
  if (!jobUrl) { showError('Please enter the Job URL.'); return; }

  const btn = document.getElementById('generateBtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span> Crafting your InMails...';
  document.getElementById('results').style.display = 'none';

  const ctaText = cta==='cv'
    ? 'End the outreach by asking for their updated CV to discuss further details.'
    : 'End the outreach by checking their interest and proposing a short call.';

  const defaultSamples = `Sample 1:
Hi {firstName}, I'm Vikash from the Talent Sourcing team at Confluent, and I hope you're doing well.
I'm currently hiring for a Staff Security Engineer II role at Confluent (Remote ‚Äì India), focused on shaping application security architecture across large-scale distributed systems and cloud platforms.
Job link: https://careers.confluent.io/jobs/...
If this aligns with your experience or interests, please feel free to share your CV, and we can discuss further. Regards

Sample 2:
Hi {firstName}, I'm the Lead Talent Sourcer for Technical Management positions across EMEA here at Confluent.
We're building the next-generation cloud network data plane to scale our Confluent Cloud platform.
Role details: [Job Link] ‚Äî Full-time permanent role (no B2B).
Let me know if this sounds interesting ‚Äî I'd be happy to connect and share more details. Best Regards

Sample 3:
Hi {firstName}, I'm Vikash Chauhan from Confluent's Talent Sourcing team.
Our Stream Processing & Analytics team is building the next-generation Apache Flink‚Äìbased stream processing engine to power Confluent Cloud.
We are hiring a Staff Engineer to define the long-term vision for a truly cloud-native data stream processor.
[Job Link] ‚Äî Germany. Would you be open to discussing this? Best Regards`;

  const sampleBlock = sample
    ? `Here are sample InMails I have previously written ‚Äî match my tone and style but improve them:\n"""\n${sample}\n"""\n`
    : `Here are sample InMails I have previously written ‚Äî match my tone and style but improve them:\n"""\n${defaultSamples}\n"""\n`;

  const fu2s = fuCount>=2?`,"followUp2":{"subject":"string","body":"string"}`:'';
  const fu3s = fuCount>=3?`,"followUp3":{"subject":"string","body":"string"}`:'';
  const fuRule = fuCount===1
    ? '- 1 follow-up "followUp": 50‚Äì80 words, warm, includes job URL.'
    : fuCount===2
    ? '- followUp (50‚Äì80w, warm, job URL) and followUp2 (50‚Äì70w, more direct, job URL).'
    : '- followUp (50‚Äì80w, warm, job URL), followUp2 (50‚Äì70w, direct, job URL), followUp3 (40‚Äì60w, final polite nudge, job URL).';

  const prompt = `You are an expert LinkedIn recruiter copywriter for Confluent. Generate InMail messages to reach a targeted candidate.

Job Description:
"""
${jd}
"""
Job URL: ${jobUrl}
CTA: ${ctaText}
${sampleBlock}

Return ONLY a raw JSON object (no markdown, no backticks, no explanation):
{"subjectLines":["s1","s2","s3","s4"],"outreach":{"subject":"string","body":"string"},"followUp":{"subject":"string","body":"string"}${fu2s}${fu3s}}

Rules:
- outreach: 120‚Äì180 words, warm, personalized, job URL embedded naturally, follows CTA.
${fuRule}
- Every subject line MUST include "Confluent" and the job location from the JD. Creative, under 12 words.
- Never use [Name] or {firstName} ‚Äî use "Hi there," or "Hello,".
- Return ONLY the JSON. Nothing else before or after.`;

  try {
    const res = await fetch(OR_URL, {
      method: 'POST',
      headers: { 'Content-Type':'application/json', 'Authorization':`Bearer ${OR_KEY}` },
      body: JSON.stringify({ model: MODEL, messages:[{role:'user',content:prompt}], temperature:0.8, max_tokens:2000 })
    });
    const data = await res.json();
    if (data.error) throw new Error(data.error.message);
    const raw = data.choices?.[0]?.message?.content || '';
    const clean = raw.replace(/```json|```/gi,'').trim();
    const r = JSON.parse(clean);

    document.getElementById('subjLines').innerHTML = (r.subjectLines||[]).map((s,i)=>
      `<div class="subj-card"><span style="color:rgba(255,255,255,0.88);font-size:0.875rem;flex:1;">"${escH(s)}"</span><button class="copy-btn" id="cs${i}" onclick="copyText(\`${esc(s)}\`,'cs${i}')">üìã Copy</button></div>`
    ).join('');

    let cards='';
    cards += msgCard('outreach','üì§','Outreach','badge-blue','First Outreach InMail',r.outreach?.subject,r.outreach?.body);
    cards += msgCard('followup','üí¨','Follow-Up 1','badge-indigo','1st Follow-Up InMail',r.followUp?.subject,r.followUp?.body);
    if(r.followUp2) cards += msgCard('followup2','üí¨','Follow-Up 2','badge-purple','2nd Follow-Up InMail',r.followUp2.subject,r.followUp2.body);
    if(r.followUp3) cards += msgCard('followup3','üí¨','Follow-Up 3','badge-pink','3rd Follow-Up InMail',r.followUp3.subject,r.followUp3.body);
    document.getElementById('msgCards').innerHTML = cards;

    document.getElementById('results').style.display = 'block';
    setTimeout(()=>document.getElementById('results').scrollIntoView({behavior:'smooth'}),100);
    toggleSection('outreach');
  } catch(err) {
    showError('Something went wrong: ' + err.message + '. Please try again.');
  } finally {
    btn.disabled = false;
    btn.innerHTML = '‚ú® Generate InMail Messages';
  }
}

function resetAll() {
  document.getElementById('jd').value='';
  document.getElementById('jobUrl').value='';
  document.getElementById('sampleInMail').value='';
  setCTA('cv'); setFU(1);
  document.getElementById('results').style.display='none';
  document.getElementById('errorBox').style.display='none';
  window.scrollTo({top:0,behavior:'smooth'});
}
</script>
</body>
</html>
